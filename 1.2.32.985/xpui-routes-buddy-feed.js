"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[1950],{96848:(e,s,a)=>{a.r(s),a.d(s,{default:()=>_s});var i=a(96651),n=a(51248),t=a(50804),l=a(12100),r=a(17160),c=a(85988),d=a(77640),o=a(93900),u=a(55504),m=a(26072),f=a(7296),x=a(81040),h=a(40636),g=(a(41260),a(75488)),b=a(10124),j=a.n(b),y=a(8004),p=a(14788),N=a(74712),k=a(7300),v=a(25676),C=a(33744),_=a(30540),L=a(81472),S=a(56684),w=a(46003),I=a(11732),E=a(88840),O=a(6812),T=a(76892),U=a(81604),A=a(52588),B=a(43619),D=a(94968),F=a(1516),H=a(2488);const z=e=>{const{timestamp:s,isNowPlaying:a}=e;return a?(0,H.jsx)(c.Yl,{label:l._s.get("time.now"),children:(0,H.jsx)(D.A,{"aria-label":l._s.get("time.now"),size:"small"})}):(0,H.jsx)("span",{children:(0,F.a)(s)})},P="gj9SOnCIzruGWAM5m3XO",M="VLKqDIGaQn2bILzJKSZ0",Y="oWQvtc5QZlmB60A9ejJx",K="dLg5WMgjh1kfYtZ_MnZz",R="VBQoaks4ZkfIknTKmxXZ",q="Irsd58UNEmDPxdhXKXCs",Z="_Xe25F2aC59Kljgqyw3G",W="P7j2kCLc27vLybuzy5XB",Q="ktMuChpoidaEvECE7y8f",J="LywlKLgNaEtHZzLM3EX5",V="mthrc5U9wb8F4zMBqlPy",G="dvb9y9hcP8sUfMhUASKO",X="kE5DI3BkNlo9zuO7K3aO",$="hnEmEncF7kB2TnE_Uyja",ee="j7K7_Zly3G1HS9MlKoao",se="gY0qK1gmEdhq5idwQc8C",ae="MObmOrMxbQpO10ebAtZA",ie="cBPbfBWIIPDzhIT6i3ih",ne="PjDcsgAPmXlcTBJRGpIu",te="IRpPQFA57qgQ5jicWWaD",le="Hm3nIbegLclY1uCAmnx_",re="bhRoVUHjWdo9mgUkU6fe",ce="BliqfY7vu_qE2C9zs5Ou",de="qdYWuHZd4HdSWfd4pSQB",oe="DhvYWKjDc7uyF3HfkDJJ",ue="ralK8s_OmE8a8zWcfNKM",me=e=>Date.now()-e<9e5,fe=(e,s)=>{const a=(0,p.nX)(e)?.type;switch(a){case p.cH.PLAYLIST:case p.cH.PLAYLIST_V2:return(0,H.jsx)(_.E,{uri:e});case p.cH.EPISODE:case p.cH.SHOW:return(0,H.jsx)(L.Q,{uri:e});case p.cH.ALBUM:return(0,H.jsx)(v.k,{uri:e,artistUri:s});case p.cH.ARTIST:return(0,H.jsx)(C.g,{uri:e});default:return null}},xe=e=>{switch(e){case p.cH.ALBUM:return B.s.ALBUM;case p.cH.ARTIST:return B.s.ARTIST;case p.cH.SHOW:return B.s.SHOW;case p.cH.EPISODE:return B.s.EPISODE;case p.cH.PLAYLIST:case p.cH.PLAYLIST_V2:return B.s.PLAYLIST;default:return}},he=e=>{const{show:s=!0,spec:a,friend:n}=e,t=(0,i.useMemo)((()=>n.user.imageUrl?[{url:n.user.imageUrl,width:0,height:0}]:[]),[n.user.imageUrl]),r=(0,f.w)(),c=(0,h.Mk)(),d=n.track,o=d.uri,{togglePlay:u,isPlaying:m,isActive:x}=(0,A.I)({uri:o},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}),g=(0,p.nX)(d.context?.uri),b=g?.type,v=(0,i.useCallback)((()=>{u(),r({intent:m?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:o});const e=a.friendRowFactory().playButtonFactory();x?m?c.logInteraction(e.hitPause({itemToBePaused:o})):c.logInteraction(e.hitResume({itemToBeResumed:o})):c.logInteraction(e.hitPlay({itemToBePlayed:o}))}),[r,m,o,a,x,u,c]),_=(0,i.useCallback)(((e,s)=>{c.logInteraction(a.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:s}))}),[c,a]),L=(0,O.C)({itemUris:[o],dragLabelText:d.name}),B=(0,O.C)({itemUris:[d.artist?.uri],dragLabelText:d.artist?.name}),D=(0,O.C)({itemUris:[d.context?.uri],dragLabelText:d.context?.name});return s?(0,H.jsxs)("div",{className:j()(P),children:[(0,H.jsx)(k.U,{menu:fe(d.context?.uri,d.artist?.uri),children:(0,H.jsxs)("div",{className:K,children:[(0,H.jsx)(N.C,{label:n.user.name,width:40,userIconSize:"small",images:t,withBadge:me(n.timestamp)}),(0,H.jsx)(E.a,{className:R,iconClassName:q,isPlaying:m,isLocked:!1,onClick:v,playAriaLabel:m?l._s.get("pause"):`${l._s.get("play")} ${d.artist.name} ${d.name}`})]})}),(0,H.jsxs)("div",{className:j()(Z),children:[(0,H.jsxs)("div",{className:W,children:[(0,H.jsx)(y.a,{as:"p",variant:"bodySmallBold",className:j()(Q,"ellipsis-one-line"),children:(0,H.jsx)(U.oL,{value:"/buddyfeed_user_profile",children:(0,H.jsx)(k.U,{menu:(0,H.jsx)(w.Y,{uri:n.user.uri}),children:(0,H.jsx)(I.Link,{title:n.user.name,to:n.user.uri,dir:"auto",onClick:()=>_("profile_link",n.user.uri),children:n.user.name})})})}),(0,H.jsx)(y.a,{as:"p",variant:"marginal",className:j()(J),children:(0,H.jsx)(z,{timestamp:n.timestamp,isNowPlaying:me(n.timestamp)})})]}),(0,H.jsxs)(y.a,{as:"p",variant:"marginal",className:V,children:[(0,H.jsx)(U.oL,{value:"/buddyfeed_track",children:(0,H.jsx)(k.U,{menu:(0,H.jsx)(S.k,{uri:d.uri,contextUri:d.context?.uri,albumUri:d.album?.uri,artists:[d.artist]}),children:(0,H.jsx)(I.Link,{title:d.name,to:o,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:L,onClick:()=>_("track_link",o),children:d.name})})}),(0,H.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,H.jsx)(U.oL,{value:"/buddyfeed_artist",children:(0,H.jsx)(k.U,{menu:d.artist?(0,H.jsx)(C.g,{uri:d.artist.uri}):null,children:(0,H.jsx)(I.Link,{title:d.artist?.name,to:d.artist?.uri,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:B,onClick:()=>_("artist_link",d.artist?.uri),children:d.artist?.name})})})]}),(0,H.jsx)(y.a,{as:"p",variant:"marginal",className:j()("ellipsis-one-line",X),children:(0,H.jsx)(U.oL,{value:"/buddyfeed_context",children:(0,H.jsx)(k.U,{menu:fe(d.context?.uri,d.artist?.uri),children:(0,H.jsxs)(I.Link,{title:d.context?.name,to:d.context?.uri,className:$,draggable:!0,onDragStart:D,onClick:()=>_("context_link",d.context?.uri),children:[(0,H.jsx)(T.Y,{type:xe(b),iconSize:16,className:G}),(0,H.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:d.context?.name})]})})})})]})]},n.user.uri):null};function ge({friends:e,spec:s}){return(0,H.jsx)(g.qK,{flipKey:e.map((e=>e.user.uri)).join(""),children:(0,H.jsx)("ol",{children:e.map(((e,a)=>(0,H.jsx)(g.OQ,{flipId:e.user.uri,children:(0,H.jsx)("li",{children:(0,H.jsx)(he,{friend:e,show:a<100,spec:s},e.user.uri)})},e.user.uri)))})})}var be=a(5540),je=a(8340),ye=a(93952),pe=a(6356),Ne=a(32976),ke=(a(73952),a(97296),a(18648)),ve=a(58024),Ce=a(76008),_e=a(25972),Le=a(70392),Se=a(5736);const we="w5nHQ74JGTytKwWanjvB",Ie="u11kJflcqt7CSXo9qL_T",Ee="MmENkh6tW0MyjTtTtPHZ",Oe="Gl0dkNQbAyNjVZ1IpghI",Te=({name:e,following:s,imageUrl:a,uri:t})=>{const c=(0,Le.s)(),d=(0,f.w)(),o=i.createRef(),[u,m]=(0,i.useState)(s);(0,Se.s)(_e.gz.OPERATION_COMPLETE,(e=>{if(e.data.uris.includes(t))switch(e.data.operation){case _e.nv.FOLLOW_USER:m(!0);break;case _e.nv.UNFOLLOW_USER:m(!1)}}));const x=(0,i.useCallback)((()=>{u?c.unfollowUsers([t]):(c.followUsers([t]),d({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),o.current&&o.current.blur()}),[u,o,t,c,d]);return(0,i.useEffect)((()=>{m(s)}),[s]),(0,H.jsxs)("div",{className:we,children:[(0,H.jsx)(N.C,{label:e,width:40,userIconSize:"small",images:(0,i.useMemo)((()=>[{width:40,height:40,url:a}]),[a])}),(0,H.jsxs)("div",{className:j()(Ie,"ellipsis-one-line"),children:[(0,H.jsx)(y.a,{as:"p",variant:"bodySmallBold",className:"ellipsis-one-line",children:e}),u&&(0,H.jsx)(y.a,{as:"p",variant:"marginal",className:"ellipsis-one-line",children:l._s.get("following")})]}),(0,H.jsx)("div",{className:Ee,children:(0,H.jsx)(r.a,{className:Oe,size:"sm",ref:o,onClick:x,ariaLabel:u?l._s.get("buddy-feed.button.remove-friend"):l._s.get("buddy-feed.button.add-friend"),icon:u?Ce.K:n.A})})]})},Ue="nGInMrf62TCFD9MBnEzz";function Ae({facebookFriends:e}){return(0,H.jsx)("div",{className:Ue,children:e.map((({uri:e,following:s,title:a,image:i})=>(0,H.jsx)(Te,{uri:e,name:a,imageUrl:i,following:s},`fb-friend-${e}`)))})}var Be=a(23482);const De="n6rSk6R7nfmSGSgTRR5_";function Fe(){return(0,H.jsx)("div",{className:De,children:Array(20).fill(0).map(((e,s)=>(0,H.jsx)(Be.O,{isLoading:!0,charCount:100,as:"p",variant:"titleSmall"},s)))})}var He=a(40468),ze=a(62196);const Pe="pZFwflwH1vXVCmAO5vbz",Me="yPL55nV5rC97vJhAf7ke",Ye="qpgo9DQ9rVZbO5pLJog5",Ke="A3hvkJOGkBNa6zWj6oZa",Re="pIyez6N1SF3jW0U5VUx4",qe="lIxuZR4lYTrEKkMYedty",Ze="VEmC3OHK3uAasHvO5OuA",We="wzGPtuvvLpOpY1PDu4Qv",Qe="YoJTUV4hazVCFNbfKoNq",Je=({onBackButtonClick:e})=>{const[s,a]=(0,i.useState)(""),{isLoading:n,friends:t}=(e=>{const s=(0,ze.C)(),a=e.trim().toLowerCase(),{data:i,isLoading:n}=(0,He.U)({queryKey:["useFacebookFriends"],queryFn:async()=>(await s.fetchFacebookFriends()).sort(((e,s)=>e.title>s.title?1:-1))});return{isLoading:n,friends:i?.filter((({title:e})=>-1!==e.trim().toLowerCase().indexOf(a)))??[]}})(s),c=(0,ke.yK)((e=>{a(e.target.value)}),100),d=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]);return(0,H.jsxs)("div",{className:Pe,children:[(0,H.jsx)(r.a,{ariaLabel:l._s.get("buddy-feed.button.back"),onClick:e,ref:d,className:Me,icon:be.C,size:"sm",testId:"back-to-friends"}),(0,H.jsxs)("div",{className:Ye,children:[(0,H.jsx)("div",{className:Ke,children:(0,H.jsx)(ye.U,{className:Re,size:"large"})}),(0,H.jsx)("div",{className:qe,children:n?(0,H.jsx)(Be.O,{isLoading:!0,charCount:25,as:"p",variant:"bodySmall"}):(0,H.jsx)(y.a,{as:"p",variant:"bodySmall",children:l._s.get("buddy-feed.number-of-friends",t.length)})})]}),n?(0,H.jsx)(Fe,{}):(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)("div",{className:Ze,children:[(0,H.jsx)(ve.O,{className:Qe,size:"small",role:"presentation"}),(0,H.jsx)("input",{onChange:c,className:We,placeholder:l._s.get("buddy-feed.find-in-playlists")})]}),(0,H.jsx)(Ae,{facebookFriends:t})]})]})};var Ve=a(15708);function Ge({isOpen:e,onClose:s,onConfirm:a}){return(0,H.jsx)(Ve.c,{onClose:s,"aria-label":l._s.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:a,titleText:l._s.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:l._s.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:l._s.get("queue.cancel-button"),confirmText:l._s.get("web-player.buddy-feed.connect-button"),isOpen:e})}let Xe=function(e){return e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e}({});const $e="EmZCbU1_B_J9RAHebolL",es="Ym6Yyx83U7mNKOMw9dxw",ss="NXcZaSipzomJ6d4_nM94",as="b9rqRkvRvhrSY4FYHQVC",is="xHc_2FQr3NxfCgfDSVhY",ns="QAJYN0xWh3h2A5d8_C1g",ts="PKhH1CknobkjJdVITsb4",ls="HgRmCE3NxfiYNtv6pF3H",rs="HnA5mipUMkheAlbxqCn_",cs="mvp0xhvZTo0xv0TIwi9u",ds=e=>{const s=(0,f.w)(),{onBackButtonClick:a,feedIsEmpty:n,goToAddFriends:t=!1}=e,c=function(){const e=(0,ze.C)(),[s,a]=(0,i.useState)(Xe.LOADING);return(0,i.useEffect)((()=>e.subscribeToFacebookConnectionState((e=>{a(e.connection?Xe.CONNECTED:Xe.DISCONNECTED)})).cancel),[e]),s}(),d=(0,ze.C)(),[o,u]=(0,i.useState)(!1),[m,x]=(0,i.useState)(!1),[h,g]=(0,i.useState)(!1),b=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]),j=(0,i.useCallback)((()=>{location.reload()}),[]);if(m)return(0,H.jsxs)("div",{className:rs,children:[(0,H.jsx)(r.a,{onClick:a,ref:b,className:ss,ariaLabel:l._s.get("buddy-feed.button.back"),icon:be.C,size:"sm"}),(0,H.jsxs)("div",{className:cs,children:[(0,H.jsx)(y.a,{as:"h1",variant:"bodyMediumBold",className:es,children:l._s.get("error-dialog.generic.header")}),(0,H.jsx)(y.a,{as:"p",variant:"bodySmall",className:as,children:l._s.get("error-dialog.generic.body")}),(0,H.jsx)(je.g,{colorSet:"invertedLight",onClick:j,children:l._s.get("error.reload")})]})]});const p=(t||h)&&c===Xe.CONNECTED;return(0,H.jsxs)("div",{className:$e,children:[p&&(0,H.jsx)(Je,{onBackButtonClick:()=>{n&&g(!1),a()}}),!p&&(0,H.jsxs)("div",{className:ns,children:[(0,H.jsx)(r.a,{ariaLabel:l._s.get("buddy-feed.button.back"),onClick:a,className:ss,ref:b,icon:be.C,size:"sm"}),(0,H.jsx)(y.a,{as:"h1",variant:"bodyMediumBold",className:es,children:l._s.get("buddy-feed.friend-activity")}),(0,H.jsx)(y.a,{as:"p",variant:"bodySmall",className:as,children:l._s.get("buddy-feed.facebook.connect-with-friends-default")}),(0,H.jsx)("div",{className:ts,children:(0,H.jsx)(je.g,{className:ls,size:"small",iconLeading:ye.U,UNSAFE_colorSet:(0,pe.En)("#2374E1",Ne.WKt),onClick:()=>{s({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),c!==Xe.CONNECTED?u(!0):g(!0)},children:l._s.get("buddy-feed.facebook.button")})}),(0,H.jsx)(y.a,{as:"p",variant:"marginal",className:is,children:l._s.get("buddy-feed.facebook.disclaimer")}),(0,H.jsx)(Ge,{isOpen:o,onClose:()=>{u(!1)},onConfirm:()=>{d.connectToFacebook().then((()=>{g(!0),u(!1)})).catch((()=>{x(!0)}))}})]})]})};var os=a(72199),us=a(29996);const ms=({showOnlineIndicator:e})=>(0,H.jsxs)("div",{className:ne,children:[(0,H.jsxs)("div",{className:te,children:[(0,H.jsx)(us.O,{size:"medium"}),e?(0,H.jsx)("div",{className:le}):null]}),(0,H.jsxs)("div",{className:re,children:[(0,H.jsx)("div",{className:j()(ce,de)}),(0,H.jsx)("div",{className:ce}),(0,H.jsx)("div",{className:ce})]})]}),fs=()=>(0,H.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:ae,children:[(0,H.jsx)(y.a,{as:"p",className:ie,children:l._s.get("buddy-feed.let-followers-see-your-listening")}),(0,H.jsx)(ms,{showOnlineIndicator:!0}),(0,H.jsx)(ms,{showOnlineIndicator:!0}),(0,H.jsx)(ms,{}),(0,H.jsx)(y.a,{as:"p",className:ie,children:l._s.get("buddy-feed.enable-share-listening-activity")}),(0,H.jsx)(os.cH,{to:"/preferences",className:oe,children:(0,H.jsx)(je.g,{colorSet:"invertedLight",className:ue,children:l._s.get("desktop.settings.settings")})})]});var xs=a(86096),hs=a(48536);const gs="jUF2eKgYMm64aYykubct",bs="zhL_lhJqzKfJVy7L5VuY",js="XqquM_o2eODcnD8Y4QhS",ys="UGtycHBJ4egymBSmD_lX",ps="ND2ydDPzwQZB7HyaGCN8",Ns="D9YN554UFGJle2CPP1TA",ks="v7Zcy9UKVUTDZIMKB6ZF",vs="RX3U6eAasqazEkuFdnj0",Cs=({children:e,page:s})=>{const a=0===s,i=e.filter(((e,a)=>a!==s));return(0,H.jsx)(xs.c,{component:null,children:i.map((e=>(0,H.jsx)(hs.c,{in:a,timeout:500,classNames:{enter:a?gs:ps,enterActive:a?bs:Ns,exit:a?js:ks,exitActive:a?ys:vs},children:e},a?"first-page":"second-page")))})},_s=({friends:e})=>{const s=(0,f.w)(),a=(0,h.Mk)(),{spec:g}=(0,h.gp)(t.q,{});(0,i.useEffect)((()=>{s({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[s]),(0,i.useEffect)((()=>{a.logImpression(g.impression())}),[a,g]);const[b,j]=(0,i.useState)(!1),y=()=>{b||a.logInteraction(g.addFriendButtonFactory().hitUiReveal()),j(!b)},p=0===e.length,N=(0,i.useCallback)((()=>{a.logInteraction(g.closeButtonFactory().hitUiHide())}),[a,g]);return(0,H.jsx)(x.Ck.Provider,{value:"buddy_feed",children:(0,H.jsx)(d.g,{label:l._s.get("buddy-feed.friend-activity"),children:(0,H.jsxs)(Cs,{page:b?1:0,children:[(0,H.jsx)("div",{className:M,children:(0,H.jsx)(ds,{onBackButtonClick:y,feedIsEmpty:p,goToAddFriends:b})}),(0,H.jsx)("div",{className:Y,children:(0,H.jsxs)(o.u,{children:[(0,H.jsx)(u._,{title:l._s.get("buddy-feed.friend-activity"),panel:m.s.BuddyFeed,onClose:N,actions:(0,H.jsx)(c.Yl,{label:l._s.get("buddy-feed.add-friends"),children:(0,H.jsx)(r.a,{ariaLabel:l._s.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:y,icon:n.A})})}),(0,H.jsx)("div",{className:ee,children:(0,H.jsx)(r.a,{ariaLabel:l._s.get("buddy-feed.add-friends"),className:se,size:"sm",onClick:y,icon:n.A})}),p?(0,H.jsx)(fs,{}):(0,H.jsx)(ge,{friends:e,spec:g})]})})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed.js.map