"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[7712],{78232:(e,t,r)=>{r.d(t,{a:()=>i});var a=r(8004),s=r(33062),n=r(2488);const i=({children:e})=>(0,n.jsx)(a.a,{variant:"bodySmall",className:s.c.pretitle,children:e})},85552:(e,t,r)=>{r.d(t,{I:()=>d});var a=r(96651),s=r(51528),n=r(92280),i=r(80060),l=r(97124),o=r(94231),c=r(83336),u=r(2488);const d=({children:e,action:t,uri:r})=>{const d=(0,n.A)(),m=(0,l.c)();let p;const h=()=>{const e={triggerId:c.o,triggerAction:{type:t}};o.F.set((t=>({...t,...e}))),m.storeAction(i.us,{operation:s.aG.ADD,uris:[r]})};try{p=a.Children.only(e)}catch(t){return(0,u.jsx)(u.Fragment,{children:e})}return d?a.cloneElement(p,{onClick:h}):(0,u.jsx)(u.Fragment,{children:e})}},41492:(e,t,r)=>{r.r(t),r.d(t,{AlbumPrerelease:()=>Ie});r(73952),r(97296),r(41260);var a=r(10124),s=r.n(a),n=r(33220),i=r(8004),l=r(14788),o=r(12100),c=r(23052),u=r(52588),d=r(43619),m=r(96651),p=r(50500),h=r(87832),g=r(40636);function b(e){const t=new Date;return(e instanceof Date?e:new Date(e)).getTime()-t.getTime()}var x=r(8340),f=r(3932),v=r(2488);const y=({uri:e})=>{const t=(0,f.s)(e),{spec:r,logger:a}=(0,g.gp)(p.h,{data:{uri:e||""}}),s=(0,m.useCallback)((()=>{e&&(a.logInteraction(r.actionBarFactory().preSaveButtonFactory().hitUiNavigate({destination:e})),t())}),[t,r,e,a]);return e?(0,v.jsx)(x.g,{onClick:s,children:o._s.get("web-player.album-prerelease.listen_now")}):null};var j=r(49612),k=r(85552),C=r(83496),_=r(92292),P=r(16824);const w=({uri:e})=>{const{isPreSaved:t,addPresave:r,removePresave:a}=(e=>{const{add:t,remove:r,useContains:a}=(0,P.U)("prerelease"),s=a(e).at(0),{enqueueSnackbar:n}=(0,_.u)();return{isPreSaved:s,addPresave:(0,m.useCallback)((async()=>{await t(e),n(o._s.get("web-player.album-prerelease.feedback_presaved"))}),[t,n,e]),removePresave:(0,m.useCallback)((async()=>await r(e)),[r,e])}})(e),{spec:s,logger:n}=(0,g.gp)(p.h,{data:{uri:e}}),i=()=>{n.logInteraction(s.actionBarFactory().preSaveButtonFactory().hitRemovePresave({prereleaseId:e,itemToBeRemovedFromPresaved:e,contextUri:e})),a()};return t?(0,v.jsx)(j.w,{onClick:i,children:o._s.get("web-player.album-prerelease.presaved")}):(0,v.jsx)(k.I,{uri:e,action:C.S_.SAVE_PRERELEASE,children:(0,v.jsx)(x.g,{disabled:void 0===t,onClick:()=>{n.logInteraction(s.actionBarFactory().preSaveButtonFactory().hitPresave({prereleaseId:e,itemToBePresaved:e,contextUri:e})),r()},children:o._s.get("web-player.album-prerelease.presave")})})};var R=r(72144),I=r(26681),T=r(48856),A=r(89520),D=r(75480);const E=({prerelease:e,backgroundColor:t})=>{const r=function(e){const[t,r]=(0,m.useState)((()=>!!e&&b(e)<=0));return(0,m.useEffect)((()=>{if(!e)return;const t=b(e);if(t<=0)return void r(!0);if(t>=36e5)return void r(!1);const a=setTimeout((()=>{r(!0)}),t);return()=>{clearTimeout(a)}}),[e]),t}(e.releaseDate),{spec:a,UBIFragment:s}=(0,g.gp)(p.h,{data:{uri:e.uri}}),n=(0,D.u)();return(0,v.jsx)(R.g,{backgroundColor:t,children:(0,v.jsxs)(I.i,{children:[r?(0,v.jsx)(y,{uri:e.content?.uri}):(0,v.jsx)(w,{uri:e.uri}),(0,v.jsx)(s,{spec:a,children:(0,v.jsx)(h.pD,{menu:(0,v.jsx)(A.u,{uri:e.uri,artistUri:e.content?.artists[0].uri}),children:(0,v.jsx)(T.g,{label:o._s.get("more.label.context",e.content?.name),size:n})})})]})})};var S=r(53048),U=r(72032),L=r(24392);const N="J9GZWbcqWAQBbj0mGgBp",F="MnacN8FHHYBeSU8hx4U8",M="HBgE42egR1M0MoBZt7MA",B="l5yLFFUEplqPqkpdgn2z",G="g0_tYvLXcZhPQLQuecrg",H="gjeF0mGZlmvlsLy5SvfQ",O=({value:e,label:t,hasDivider:r=!1})=>(0,v.jsxs)("div",{className:M,"aria-hidden":"true",children:[(0,v.jsx)(i.a,{variant:"titleSmall",className:s()({[G]:r}),children:e}),(0,v.jsx)(i.a,{variant:"marginal",semanticColor:"textSubdued",children:t})]});var Q=r(15868);const Z=1e3,q=60*Z,z=60*q,W=24*z;const K={days:0,hours:0,minutes:0,seconds:0};function V(e){return e>0?function(e){const t=Math.abs(e);return{days:Math.floor(t/W),hours:Math.floor(t%W/z),minutes:Math.floor(t%z/q),seconds:Math.floor(t%q/Z)}}(e):K}const X=({targetDate:e,className:t,onComplete:r,images:a,imageTitle:n})=>{const{days:i,hours:l,minutes:c,seconds:u}=((e,t)=>{const r=(0,m.useRef)(t);r.current=t;const[a,s]=(0,m.useState)((()=>V(b(e))));return(0,Q.f)((t=>{const a=b(e),n=V(a);s(n),a<=0&&(t(),r.current?.())}),1e3),a})(e,r),p=void 0!==a&&a.length>0&&n,h=o._s.get("web-player.album-prerelease.countdown_label",{days:i,hours:l,minutes:c,seconds:u});return(0,v.jsxs)("div",{className:s()(N,t,{[F]:p}),role:"timer",children:[(0,v.jsx)("span",{className:H,children:h}),p&&(0,v.jsx)(L.i,{images:a,type:d.s.ALBUM,shape:L.O.ROUNDED_CORNERS,className:B,title:n}),(0,v.jsx)(O,{value:i,label:o._s.get("web-player.album-prerelease.days",i),hasDivider:!0}),(0,v.jsx)(O,{value:l,label:o._s.get("web-player.album-prerelease.hours",l),hasDivider:!0}),(0,v.jsx)(O,{value:c,label:o._s.get("web-player.album-prerelease.minutes",c),hasDivider:!0}),(0,v.jsx)(O,{value:u,label:o._s.get("web-player.album-prerelease.seconds",u)})]})};var Y=r(1044),$=r(62688),J=r(73372),ee=r(78232);const te="xjbmV4vvBCu7c5U6nAgL",re=({prerelease:e,children:t})=>(0,v.jsx)(h.UF,{menu:(0,v.jsx)(A.u,{uri:e.uri,artistUri:e.content?.artists[0].uri}),children:t}),ae=({prerelease:e,backgroundColor:t})=>{const{content:r,releaseDate:a}=e,s=(0,S.oV)(),n=s===S.u_.SMALL||s===S.u_.XSMALL,{spec:i,logger:l}=(0,g.gp)(p.h,{data:{uri:e.uri}}),o=(0,m.useCallback)(((e,t)=>{if(i){const e=i.headerFactory().artistNameFactory().hitUiNavigate({destination:t.creator.uri});l.logInteraction(e)}}),[l,i]),c=r,u=(0,m.useMemo)((()=>a?new Date(a):void 0),[a]);return(0,v.jsxs)(Y.I1,{backgroundColor:t,size:Y.Yj.LARGE,children:[(0,v.jsx)($.E,{children:c.name?(0,v.jsx)(J.e,{text:c.name}):null}),!n&&(0,v.jsx)(re,{prerelease:e,children:(0,v.jsx)(Y.gR,{images:c.coverArt.sources,name:c.name??"",placeholderType:"album"})}),(0,v.jsxs)(Y.a8,{children:[(0,v.jsx)(ee.a,{children:(0,U.E)(c.type)}),(0,v.jsx)(re,{prerelease:e,children:(0,v.jsx)(Y.on,{scaleAtMinWidth:Y.Oo,children:c.name})}),(0,v.jsx)(Y.E1,{creators:c.artists,onCreatorClick:o,releaseDate:a,timeZone:e.timezone}),u&&c.name?(0,v.jsx)(X,{images:n?c.coverArt.sources:[],className:te,imageTitle:c.name,targetDate:u}):null]})]})};var se=r(33912),ne=r(37200),ie=r(66514),le=r(84340),oe=r(88272),ce=r(99972);const ue=new oe.a("albumPreReleaseTracks","query","57be1f8d98e931e2b072477e574702caa67263d4ee779bc9bf4d9b0727b5effe",null),de={totalLength:0,items:[]};function me(e){const t=e.preReleaseContent,r=[];if(t?.tracks)for(const e of t.tracks.items)r.push({uri:e.uri,name:e.name?e.name:"",isPlayable:e.playability.playable,durationMs:e.duration?.totalMilliseconds??0,artists:pe(e.artists.items),isExplicit:e.contentRating?.label===le.A7.Explicit,is19PlusOnly:e.contentRating?.label===le.A7.NineteenPlus});return{totalLength:t?.tracks.totalCount??0,items:r}}function pe(e){const t=[];for(const r of e)"Artist"===r.data.__typename&&t.push({name:r.data.profile.name,uri:r.data.uri});return t}const he=[se.yw.INDEX,se.yw.TITLE_AND_ARTIST,se.yw.DURATION],ge=m.memo((function({ariaLabel:e,nrTracks:t,prereleaseUri:r,highlightUri:a,scrollToIndex:s,usePlayContextItem:n,hasHeaderRow:i=!0,initalTracks:l}){const{spec:o,UBIFragment:c}=(0,g.gp)(p.h,{data:{uri:r}}),u=(e=>{const{request:t}=(0,m.useContext)(ie.Q9);return(0,m.useCallback)((async(r,a)=>{const s=await t(ue,{uri:e,offset:r,limit:a});for(const t of s?.data?.lookup||[])if("PreReleaseResponseWrapper"===t.__typename&&"PreRelease"===t.data.__typename&&t.data.uri===e)return me(t.data);return de}),[t,e])})(r),d=(0,m.useRef)(!1),h=(0,m.useRef)(null),[b,x]=(0,m.useState)(null),f=(0,m.useCallback)((e=>({uri:e.uri})),[]);(0,m.useEffect)((()=>{h.current&&(b?h.current.scrollToIndex(b):s&&h.current.scrollToIndex(s))}),[b,s]);const y=(0,m.useCallback)((async(e,t)=>{const r=await u(e,t);if(a&&!b){const e=r.items.findIndex((e=>e?.uri===a));x(e||-1)}return r}),[u,a,b]),j=(0,m.useCallback)(((e,t)=>{const s=!d.current&&!!a&&a===e.uri;return s&&(d.current=!0),(0,v.jsx)(se.I2,{uri:e.uri,isPlayable:e.isPlayable,name:e.name,trackNumber:t+1,index:t,artists:e.artists,playcount:0,contextUri:r,duration_ms:e.durationMs,usePlayContextItem:n,isMOGEFRestricted:e.is19PlusOnly,isExplicit:e.isExplicit,shouldHighLight:s,isReleased:e.isPlayable},t+e.uri)}),[a,r,n]);return(0,v.jsx)(c,{spec:o,children:(0,v.jsx)(ne.i,{columns:he,children:(0,v.jsx)(se.aE,{ariaLabel:e,columns:he,hasHeaderRow:i,rowPlaceholder:se.uK,renderRow:j,resolveItem:f,nrTracks:t,fetchTracks:y,limit:300,tracks:l,outerRef:h,columnPersistenceKey:"album-tracklist"},r)})})}));var be=r(864),xe=r(92376),fe=r(46736);const ve=new oe.a("albumPreRelease","query","f8fb044f6c0f01764e8264814366456656ea7775866a7a9bd7bd5ba96a78679a",null),ye=(e,t)=>(0,ce.U)(ve,e,t),je=(e,t=ye)=>{const{data:r,loading:a,error:s}=t({uri:e},{staleTime:3e5,gcTime:36e5});return{loading:a,error:!!s,prerelease:(0,m.useMemo)((()=>{if(!r)return null;for(const t of r.lookup)if("PreReleaseResponseWrapper"===t.__typename&&"PreRelease"===t.data.__typename&&t.data.uri===e)return Ce(t.data);return null}),[r,e])}};function ke(e){return e.includes("℗")?{type:"P",text:e}:{type:"C",text:e}}function Ce(e){const t=e.preReleaseContent;let r;if(t){const a=me(e);r={artists:_e(t.artists.items),name:t.name??void 0,uri:t.uri,coverArt:{extractedColors:t.coverArt?.extractedColors?.colorRaw,sources:t.coverArt?.sources??[]},type:t.type,tracks:a,copyrights:t.copyright?.split("\n").map(ke)??[]}}return{uri:e.uri,releaseDate:e.releaseDate?.isoString,timezone:e.timezone??void 0,content:r}}function _e(e){const t=[];for(const r of e)"Artist"===r.data.__typename&&t.push({name:r.data.profile.name,id:r.data.id,uri:r.data.uri,images:r.data.visuals.avatarImage?.sources??[]});return t}var Pe=r(96956);const we="H2kQJCtEGTjIDaPPniwb",Re="ZSU92ZH1fIuGwPp1cuDi",Ie=e=>{const{uri:t}=e,{prerelease:r,loading:a,error:m}=je(t),p=(e=>{const t=e?.content?.coverArt.extractedColors?.hex;return(0,Pe.a)(t),t})(r),h=parseInt(new URLSearchParams((0,n.IT)().search).get("index")||"0",10),{usePlayContextItem:g}=(0,u.I)({uri:t,pages:[{items:(x=r?.content?.tracks.items||[],x.filter((e=>e.isPlayable)).map((e=>({uri:e.uri,uid:null,type:d.s.TRACK,provider:null}))))}]},{featureIdentifier:"album_prerelease"});var x;if(a||m||!r)return(0,v.jsx)(xe.K,{hasError:!!m,errorMessage:o._s.get("error.not_found.title.album")});if(r?.content?.uri&&function(e,t){if(!e.content?.uri||!e.releaseDate)return!1;const r=b(e.releaseDate);if(r>0)return!1;return r<=-1*t}(r,1728e5)){const e=(0,l.k3)(r?.content?.uri);if(e)return(0,v.jsx)(fe.InstrumentedRedirect,{to:e.toURLPath(!0)})}return(0,v.jsxs)("section",{className:we,children:[(0,v.jsx)(be.Q,{children:o._s.get("album.page-title",r.content?.name??"")}),(0,v.jsx)(ae,{prerelease:r,backgroundColor:p}),(0,v.jsx)(E,{prerelease:r,backgroundColor:p}),r.content?.tracks.totalLength?(0,v.jsxs)("div",{className:"contentSpacing",children:[(0,v.jsx)(i.a,{as:"h2",variant:"titleSmall",semanticColor:"textBase",children:o._s.get("web-player.album-prerelease.tracklist_preview")}),(0,v.jsx)(ge,{prereleaseUri:t,ariaLabel:r.content?.name??o._s.get("error.not_found.title.album"),nrTracks:r.content?.tracks.totalLength??0,scrollToIndex:h,usePlayContextItem:g,initalTracks:r.content?.tracks.items,albumUri:r.content?.uri})]}):null,(0,v.jsx)("div",{className:s()(Re,"contentSpacing"),children:(0,v.jsx)(c.k,{copyrights:r.content?.copyrights??[]})})]})}},23052:(e,t,r)=>{r.d(t,{k:()=>i});r(41260);var a=r(90464);const s="rTMkDBDp47Eo12ZEQv4U";var n=r(2488);const i=({copyrights:e,courtesyLine:t})=>{const r=(e||[]).map(((e,t)=>{const r=e.text.replace(/^(\(C\)\s+)/,"").replace(/^(\(P\)\s+)/,"").replace(/^(©\s+)/,"").replace(/^(℗\s+)/,"");let s;return s="C"===e.type?"©":"P"===e.type?"℗":`(${e.type})`,(0,n.jsx)(a.F,{as:"p",variant:"finale",dir:"auto",children:`${s} ${r}`},t)}));return t&&r.unshift((0,n.jsx)(a.F,{as:"p",variant:"finale",dir:"auto",children:t},r.length)),(0,n.jsx)("div",{className:s,children:r})}}}]);
//# sourceMappingURL=xpui-routes-album-prerelease.js.map